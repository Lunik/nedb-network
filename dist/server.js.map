{"version":3,"sources":["../server.js"],"names":["Object","defineProperty","exports","value","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","prototype","_typeof","Symbol","iterator","obj","constructor","_express","require","_express2","_interopRequireDefault","_compression","_compression2","_bodyParser","_bodyParser2","_nedb","_nedb2","__esModule","default","_classCallCheck","instance","TypeError","parseJSON","json","JSON","stringify","parse","k","v","isNaN","parseFloat","Server","port","token","path","_this","databases","app","use","urlencoded","extended","listen","console","log","request","response","next","headers","authorization","status","end","get","query","loadDB","__database","db","find","err","res","toString","data","post","body","insert","update","options","remove","cb","filename","loadDatabase","persistence","compactDatafile"],"mappings":"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","file":"server.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _express = require('express');\n\nvar _express2 = _interopRequireDefault(_express);\n\nvar _compression = require('compression');\n\nvar _compression2 = _interopRequireDefault(_compression);\n\nvar _bodyParser = require('body-parser');\n\nvar _bodyParser2 = _interopRequireDefault(_bodyParser);\n\nvar _nedb = require('nedb');\n\nvar _nedb2 = _interopRequireDefault(_nedb);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction parseJSON(json) {\n  json = JSON.stringify(json);\n  return JSON.parse(json, function (k, v) {\n    return (typeof v === 'undefined' ? 'undefined' : _typeof(v)) === 'object' || isNaN(v) || v === '' ? v : parseFloat(v, 10);\n  });\n}\n\nvar Server = function () {\n  function Server(port, token, path) {\n    var _this = this;\n\n    _classCallCheck(this, Server);\n\n    this.token = token;\n    this.databases = {};\n    this.path = path || 'data/';\n\n    this.app = (0, _express2.default)();\n    this.app.use((0, _compression2.default)());\n\n    this.app.use(_bodyParser2.default.urlencoded({\n      extended: true\n    }));\n\n    this.app.listen(port, '127.0.0.1', function () {\n      console.log('Database listening at port ' + port);\n    });\n\n    this.app.use(function (request, response, next) {\n      if (request.headers.authorization === _this.token) {\n        next();\n      } else {\n        response.status(403);\n        response.end();\n      }\n    });\n\n    this.app.get('/api/find', function (request, response) {\n      var query = parseJSON(request.query);\n      _this.loadDB(query.__database, function () {\n        var db = query.__database;\n        delete query.__database;\n\n        _this.databases[db].find(query || {}, function (err, res) {\n          response.end(JSON.stringify({\n            err: err ? err.toString() : '',\n            data: res\n          }));\n        });\n      });\n    });\n\n    this.app.post('/api/insert', function (request, response) {\n      var body = parseJSON(request.body);\n      _this.loadDB(body.__database, function () {\n        var db = body.__database;\n        delete body.__database;\n\n        _this.databases[db].insert(body || {}, function (err) {\n          response.end(JSON.stringify({\n            err: err ? err.toString() : ''\n          }));\n        });\n      });\n    });\n\n    this.app.post('/api/update', function (request, response) {\n      var body = parseJSON(request.body);\n      _this.loadDB(body.__database, function () {\n        var db = body.__database;\n        delete body.__database;\n\n        _this.databases[db].update(body.query || {}, body.data || {}, body.options || {}, function (err) {\n          response.end(JSON.stringify({\n            err: err ? err.toString() : ''\n          }));\n        });\n      });\n    });\n\n    this.app.post('/api/remove', function (request, response) {\n      var body = parseJSON(request.body);\n      _this.loadDB(body.__database, function () {\n        var db = body.__database;\n        delete body.__database;\n\n        _this.databases[db].remove(body.query || {}, body.options || {}, function (err) {\n          response.end(JSON.stringify({\n            err: err ? err.toString() : ''\n          }));\n        });\n      });\n    });\n  }\n\n  _createClass(Server, [{\n    key: 'loadDB',\n    value: function loadDB(db, cb) {\n      if (this.databases[db] == null) {\n        this.databases[db] = new _nedb2.default({ filename: this.path + '/' + db + '.db' });\n        this.databases[db].loadDatabase(cb);\n        this.databases[db].persistence.compactDatafile();\n      } else {\n        cb();\n      }\n    }\n  }]);\n\n  return Server;\n}();\n\nexports.default = Server;"]}